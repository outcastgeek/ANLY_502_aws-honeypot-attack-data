---
title: "ANLY 502 Group Project Report"
author:
 - "Akpany Benjamin Ebby"
 - "Amit Augustine"
 - "Zongxia Li"
date: "`r format(Sys.time(), '%d %B %Y')`"
output:
  pdf_document:
    highlight: zenburn
comment: Rmd Document with Markdown + Embedded R Code
---

#### Document as of `r Sys.Date()`

```{r setup, include=FALSE, purl=FALSE, eval=TRUE}

source('R/ANLY502_GroupProjectData_Helper.R')

```

```{r echo=FALSE}

library(knitr)
library(printr)
library(formatR)
read_chunk('R/ANLY502_GroupProjectData_Chunks.R')

```

*Install the Required Libraries if not installed*
```{r installLibraries, echo=FALSE}
```

*Load the Required Libraries*
```{r loadLibraries, echo=FALSE}
```

Some [helper functions] do exists to support the code snippets below such as: ```loadSheetFromFile```

```{r helperFunctions, echo=FALSE}
```

#General Description of Data

The AWS Honeypot Database is an open-source database including information on cyber attacks/attempts.
Data has 451,581 data points collected from 9:53pm on 3 March 2013 to 5:55am on 8 September 2013.
The Data is in the CSV format with a size of ```47MB```, and is a ```6MB``` zipped download.
We will analyze this Data to identify any trends or correlations that could possibly be used in predictive cyber threat vectors.

---

Let's start by [Loading the Data Sheets]

```{r loadSheets, echo=FALSE, warning=FALSE}
```

*Structure of Data*

```{r}
str(HoneypotAttack) #Good way to quickly show the structure of something
```

*Description of Data*

```{r}
stat.desc(HoneypotAttack)
```

#List of explanatory variables

The explanatory variables are:	**src,	proto, type, spt, dpt, srcstr, cc, country, locale, localeabbr**

__src:__ the origin of the attack
__proto:__ the network protocol used during for the attack
__srcstr:__ the ip address of the attack origin
__cc:__ the country code
__country:__ the country of the origin of the attack
__locale:__ the locale of the origin of the attack
__localeabbr:__ the locale abbreviation of the origin of the attack

*Summary of Data*

```{r}
summary(HoneypotAttack)
```

Now let's [Adjust the Attacks Data]
```{r, attacksData, echo=FALSE}
```

## Attacks by Protocol

```{r protocolAttacks, echo=FALSE}
```

Then, let us [Adjust the Attacks Data]

```{r attacksData, echo=FALSE, warning=FALSE}
```

Then, let us [Setup the Mapping Data]

```{r mappingData, echo=FALSE, warning=FALSE}
```

Finally, let us [Plot the Attacks Data on the Map]

```{r mapPlots, echo=FALSE, warning=FALSE}
``` 

## Attacks according to US locations

The purpose of this section is to analyze the frequency of attacks in each location in US. Histogram is used to do the analysis.
```{r}
library(dplyr)
library(ggplot2)
HoneypotAttack <- read.csv("AWS_Honeypot_marx-geo.csv")
HoneypotAttack <- HoneypotAttack[,1:15]
HoneypotAttack_us <- HoneypotAttack %>% filter(host %in% c("groucho-oregon","groucho-us-east", "groucho-norcal"))
hist <- ggplot(data.frame(HoneypotAttack_us$host), aes(x=HoneypotAttack_us$host)) +  geom_bar()
hist + labs(x = "Host", y = "Count", title = "Histogram of host locations in US") #Histogram of attacks according to US locations
```
According to the histogram, the attacks occur in Orgon most frequently, following by US-East, and North California.

## Prediction of next attack time

One of the valuable information we want to know is when the next attack will occur. This section uses forecast() function to do the time series prediction. 

```{r}
library(lubridate)
library(forecast)
time <- mdy_hm(HoneypotAttack$datetime) #convert datetime to Date
time_num <- hour(time) + minute(time)/60  #extract hour and minute and convert it to numeric
time_num <- data.frame(time_num)
timepred <- auto.arima(time_num) #time series prediction
plot(forecast(timepred, h=20), main = "Forecast of next attack time") #plot of forecast result
forecast(timepred, h=5) #forecast result, seeing the Forecast, you need to convert the numeric to Date. eg 5.982467 is 5:59. Therefore, the next attack will be at 5:59
```
The plot shows the prediction of the time of the next 20 attacks.

According to the tables, the next attack will occur at 5.982467 which corresponding to 5:59 on 9/8/13. 

## Prediction of next attack location

Another valuable information we want to know is where the next attack will occur. This section uses multinorm() function to do the location prediction. Multinomial logistic regression is used to model nominal outcome variables, in which the log odds of the outcomes are modeled as a linear combination of the predictor variables. 
```{r}
split <- round(nrow(HoneypotAttack)*0.8)
training <- HoneypotAttack[1:split,]
testing <- HoneypotAttack[(split + 1):nrow(HoneypotAttack),] # split data into train data and test data
locationpred <- multinom(host ~ src + spt + dpt, data = training) #regression model
summary(locationpred)
z <- summary(locationpred)$coefficients/summary(locationpred)$standard.errors
p <- (1 - pnorm(abs(z), 0, 1)) * 2 #p-value of each variable
p
prediction <- predict(locationpred, newdata = testing, "probs") #the prediction result shows the probability of the attack occuring at each locations
prediction
attacklocationprob <- data.frame(colMeans(prediction,na.rm = TRUE))
attacklocationprob <- cbind(rownames(attacklocationprob), data.frame(attacklocationprob, row.names=NULL))
colnames(attacklocationprob) <- c("location","probability") #the average probability of the attack occuring at each locations
attacklocationprob
attacklocationprob$location
ggplot(attacklocationprob, aes(x = attacklocationprob$location, y = attacklocationprob$probability)) + geom_boxplot()
```
The prediction result shows the probability of the attack occuring at each locations. The attacklocationprob table shows the average probability of the attack occuring at each locations.
---

# Appendix:

### Required Libraries

```{r installLibraries, eval=FALSE}
```

```{r loadLibraries, eval=FALSE}
```

### Helper Functions

```{r helperFunctions, eval=FALSE}
```

### Loading the Data Sheets

```{r loadSheets, eval=FALSE}
```

### Adjust the Attacks Data

```{r attacksData, eval=FALSE}
```

### Setup the Mapping Data

```{r mappingData, eval=FALSE}
```

### Plot the Attacks Data on the Map

```{r mapPlots, eval=FALSE}
```

#Data Source

[Kaggle: AWS Honeypot Attack Data](https://www.kaggle.com/casimian2000/aws-honeypot-attack-data)
```
https://www.kaggle.com/casimian2000/aws-honeypot-attack-data
```
